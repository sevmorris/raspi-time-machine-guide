# Raspberry Pi Time Machine — Build, Operate & Troubleshoot

_Revision: autogenerated from current system snapshot — tm-docs-20251017-093000.tgz_


---

## 1) At‑a‑Glance

- **Hostname:** `<pi-hostname>`

- **OS:** Debian GNU/Linux 12 (bookworm)

- **Samba:** 4.x

- **Share:** `global` → `/srv/timemachine` (Time Machine enabled)

- **Quota (fruit:time machine max size):** `800G`



## 2) Quickstart Runbook

1. **Update & install**

   ```bash
   sudo apt update && sudo apt -y install samba avahi-daemon
   ```

2. **Create/verify mount** (external SSD): ensure it’s in `/etc/fstab` and mounted at `/srv/timemachine`.

3. **Configure Samba (Time Machine)** — use the `smb.conf` below, then test & restart:

   ```bash
   testparm -s
   sudo systemctl restart smbd
   ```

4. **Advertise via Bonjour** (Avahi). If using a custom service file, place it in `/etc/avahi/services/` and restart:

   ```bash
   sudo systemctl restart avahi-daemon
   ```

5. **From macOS**: Connect in Finder → Go → Connect to Server → `smb://<pi-hostname>/<share-name>` and add in **System Settings → Time Machine**.

6. **Verify**: on Mac, run:

   ```bash
   tmutil destinationinfo
   smbutil statshares -a
   ```


## 3) System Architecture

- **Hardware:** Raspberry Pi 4 + USB SSD
- **Services:** `smbd` (SMB), `avahi-daemon` (Bonjour)
- **Filesystem:** `ext4` mounted at `/srv/timemachine`


## 4) Installation & Configuration Details

### 4.1 `/etc/fstab`

```ini
proc            /proc           proc    defaults          0       0
PARTUUID=a7b41a6e-01  /boot/firmware  vfat    defaults          0       2
PARTUUID=a7b41a6e-02  /               ext4    defaults,noatime,lazytime  0       1
# a swapfile is not a swap partition, no line here
#   use  dphys-swapfile swap[on|off]  for that
UUID=21f34b8f-69e9-4086-b605-15c0e90cfe47  /mnt/timemachine  ext4  defaults,noatime,lazytime,nofail,x-systemd.device-timeout=10  0  2
```

### 4.2 `/etc/samba/smb.conf` (redacted)

```ini
[global]
   server role = standalone server
   workgroup = WORKGROUP

   # Protocols
   server min protocol = SMB2
   client min protocol = SMB2
   client max protocol = SMB3

   # Discovery (NetBIOS off; Avahi/mDNS handles TM)
   disable netbios = Yes
   mdns name = mdns

   # Security / integrity
server signing = auto
   # smb encrypt = required   # (optional, CPU cost)

   security = user
   map to guest = never

   # macOS compatibility
   vfs objects = catia fruit streams_xattr
   fruit:encoding = native
   fruit:resource = stream
   fruit:metadata = stream
   fruit:locking = none
   fruit:zero_file_id = yes

   # **HARD BIND**: loopback + eth0 address ONLY
   interfaces = <LAN_IP>/8 <LAN_IP>/32
   bind interfaces only = yes

   # (Optional) Drop legacy port 139; use modern 445 only
   smb ports = 445

   # Misc
   idmap config * : backend = tdb
   load printers = no
   printing = bsd
   printcap name = /dev/null

   ntlm auth = yes
[TimeMachine]
   path = /mnt/timemachine
   read only = No
   valid users = <username>
   create mask = 0600
   directory mask = 0700
   veto files = /._*/.DS_Store/
   vfs objects = fruit streams_xattr
   fruit:time machine = yes
   fruit:time machine max size = 800G

[global]

[global]
```

### 4.4 Verify Samba configuration

```bash
# testparm -s
# Global parameters
[global]
	bind interfaces only = Yes
	client max protocol = SMB3
	client min protocol = SMB2
	disable netbios = Yes
	interfaces = <LAN_IP>/8 <LAN_IP>/32
	load printers = No
	mdns name = mdns
	ntlm auth = ntlmv1-permitted
	printcap name = /dev/null
	security = USER
	server min protocol = SMB2
	server role = standalone server
	server signing = if_required
	smb ports = 445
	fruit:zero_file_id = yes
	fruit:locking = none
	fruit:metadata = stream
	fruit:resource = stream
	fruit:encoding = native
	idmap config * : backend = tdb
	printing = bsd
	vfs objects = catia fruit streams_xattr


[TimeMachine]
	create mask = 0600
	directory mask = 0700
	path = /mnt/timemachine
	read only = No
	valid users = <username>
	veto files = /._*/.DS_Store/
	vfs objects = fruit streams_xattr
	fruit:time machine max size = 800G
	fruit:time machine = yes
```


## 5) macOS Client Setup & Checks

**Collected from your Mac:**

```text
sw_vers
ProductName:		macOS
ProductVersion:		15.7.1
BuildVersion:		24G231

tmutil destinationinfo
====================================================
Name          : TimeMachine
Kind          : Network
URL           : smb://<username>@<pi-hostname>._smb._tcp.local./<share-name>
ID            : 4F088F59-55A7-40A0-A54B-928240B24DC4


tmutil status
Backup session status:
{
    ClientID = "com.apple.backupd";
    Percent = "-1";
    Running = 0;
}


smbutil statshares -a

==================================================================================================
SHARE                         ATTRIBUTE TYPE                VALUE
==================================================================================================

--------------------------------------------------------------------------------------------------
```

## 6) Operations & Maintenance

- Restart services: `sudo systemctl restart smbd avahi-daemon`

- Check status: `systemctl status smbd` and `journalctl -u smbd --since "-1d"`

- Monitor disk: `df -hT` and `lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT,UUID`

- Update cadence: `sudo apt update && sudo apt -y upgrade`


## 7) Sizing & Quotas

- Typical guidance: set Time Machine max size to **70–90%** of the dedicated disk.

- Current setting appears to be `800G` for a 1 TB disk (sensible headroom).


## 8) Troubleshooting Playbook

### NT_STATUS_NTLM_BLOCKED

- Ensure **SMB2/3** only (disable SMB1) and allow modern NTLM where necessary.

- In `smb.conf` (global):

  ```ini
  server min protocol = SMB2
  client min protocol = SMB2
  ntlm auth = yes
  ```

- On macOS, remove stale Keychain items for the server and reconnect.


### Share visible but cannot mount
- Verify permissions/ownership of `/srv/timemachine` and parent path.
- Check `journalctl -u smbd` for ACL or path denials.


### Backups stall/fail
- Inspect network stability and I/O (`dmesg`, USB power, SMART if available).
- Consider repairing the sparsebundle on macOS via Disk Utility or `hdiutil` (with caution).


## 9) Logs (Recent excerpts)

### smbd (last 7 days)
```text
Oct 15 09:50:53 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 09:50:54 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 15 09:51:59 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 15 09:51:59 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 15 09:51:59 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 15 09:51:59 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 09:52:00 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 15 09:54:18 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 15 09:54:18 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 15 09:54:18 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 15 09:54:18 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 09:54:18 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 15 10:02:57 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 15 10:02:57 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 15 10:02:57 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 15 10:02:58 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 10:02:58 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 15 10:22:42 <pi-hostname> smbd[2706]: pam_unix(samba:session): session opened for user <username>(uid=1000) by (uid=0)
Oct 15 10:22:44 <pi-hostname> smbd[2706]: pam_unix(samba:session): session closed for user <username>
Oct 15 10:32:32 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 15 10:32:32 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 15 10:32:32 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 15 10:32:32 <pi-hostname> systemd[1]: smbd.service: Consumed 5.520s CPU time.
Oct 15 10:32:33 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 10:32:33 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 15 10:33:12 <pi-hostname> smbd[3374]: pam_unix(samba:session): session opened for user <username>(uid=1000) by (uid=0)
Oct 15 10:33:14 <pi-hostname> smbd[3374]: pam_unix(samba:session): session closed for user <username>
Oct 15 10:35:24 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 15 10:35:24 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 15 10:35:24 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 15 10:35:24 <pi-hostname> systemd[1]: smbd.service: Consumed 6.122s CPU time.
Oct 15 10:35:24 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 15 10:35:25 <pi-hostname> smbd[3932]: [2025/10/15 10:35:25.033571,  0] ../../source3/smbd/server.c:1741(main)
Oct 15 10:35:25 <pi-hostname> smbd[3932]:   smbd version 4.17.12-Debian started.
Oct 15 10:35:25 <pi-hostname> smbd[3932]:   Copyright Andrew Tridgell and the Samba Team 1992-2022
Oct 15 10:35:25 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 09:01:53 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 09:01:53 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 09:01:53 <pi-hostname> smbd[3932]: [2025/10/16 09:01:53.901640,  0] ../../lib/param/loadparm.c:1551(set_variable_helper)
Oct 16 09:01:53 <pi-hostname> smbd[3932]:   set_variable_helper(yes ; keep extended attributes): value is not boolean!
Oct 16 09:22:59 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 09:22:59 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 09:32:22 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 09:32:22 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 09:48:43 <pi-hostname> smbd[16443]: [2025/10/16 09:48:43.691012,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 09:48:43 <pi-hostname> smbd[16443]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 09:48:43 <pi-hostname> smbd[16443]: [2025/10/16 09:48:43.692472,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 09:48:43 <pi-hostname> smbd[16443]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 16 11:05:56 <pi-hostname> smbd[16695]: [2025/10/16 11:05:56.160313,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 11:05:56 <pi-hostname> smbd[16695]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 11:05:56 <pi-hostname> smbd[16695]: [2025/10/16 11:05:56.161346,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 11:05:56 <pi-hostname> smbd[16695]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 16 12:06:23 <pi-hostname> smbd[16802]: [2025/10/16 12:06:23.331368,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 12:06:23 <pi-hostname> smbd[16802]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 12:06:23 <pi-hostname> smbd[16802]: [2025/10/16 12:06:23.331522,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 12:06:23 <pi-hostname> smbd[16802]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 16 15:07:04 <pi-hostname> smbd[16443]: [2025/10/16 15:07:04.644111,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 15:07:04 <pi-hostname> smbd[16443]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 15:07:04 <pi-hostname> smbd[16443]: [2025/10/16 15:07:04.644295,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 15:07:04 <pi-hostname> smbd[16443]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 16 16:26:54 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 16:26:54 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 16:29:49 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 16:29:49 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 16:37:49 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 16:37:49 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 16:41:06 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 16:41:06 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 16:42:54 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 16 16:42:54 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 16 16:42:54 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 16 16:42:54 <pi-hostname> systemd[1]: smbd.service: Consumed 3h 14min 49.198s CPU time.
Oct 16 16:42:55 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 16 16:42:55 <pi-hostname> smbd[22251]: [2025/10/16 16:42:55.371278,  0] ../../source3/smbd/server.c:1741(main)
Oct 16 16:42:55 <pi-hostname> smbd[22251]:   smbd version 4.17.12-Debian started.
Oct 16 16:42:55 <pi-hostname> smbd[22251]:   Copyright Andrew Tridgell and the Samba Team 1992-2022
Oct 16 16:42:55 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 18:01:53 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 16 18:01:53 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 16 18:01:53 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 16 18:01:53 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 16 18:01:54 <pi-hostname> smbd[31158]: [2025/10/16 18:01:54.242123,  0] ../../source3/smbd/server.c:1741(main)
Oct 16 18:01:54 <pi-hostname> smbd[31158]:   smbd version 4.17.12-Debian started.
Oct 16 18:01:54 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 18:06:41 <pi-hostname> systemd[1]: Reloading smbd.service - Samba SMB Daemon...
Oct 16 18:06:41 <pi-hostname> systemd[1]: Reloaded smbd.service - Samba SMB Daemon.
Oct 16 18:07:05 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 16 18:07:05 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 16 18:07:05 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 16 18:07:05 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 16 18:07:05 <pi-hostname> smbd[31303]: [2025/10/16 18:07:05.951739,  0] ../../source3/smbd/server.c:1741(main)
Oct 16 18:07:05 <pi-hostname> smbd[31303]:   smbd version 4.17.12-Debian started.
Oct 16 18:07:05 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 19:24:02 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 16 19:24:02 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 16 19:24:02 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 16 19:24:02 <pi-hostname> systemd[1]: smbd.service: Consumed 1.021s CPU time.
Oct 16 19:24:02 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 16 19:24:03 <pi-hostname> smbd[33259]: [2025/10/16 19:24:03.189414,  0] ../../source3/smbd/server.c:1741(main)
Oct 16 19:24:03 <pi-hostname> smbd[33259]:   smbd version 4.17.12-Debian started.
Oct 16 19:24:03 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 19:31:48 <pi-hostname> systemd[1]: Stopping smbd.service - Samba SMB Daemon...
Oct 16 19:31:48 <pi-hostname> systemd[1]: smbd.service: Deactivated successfully.
Oct 16 19:31:48 <pi-hostname> systemd[1]: Stopped smbd.service - Samba SMB Daemon.
Oct 16 19:31:48 <pi-hostname> systemd[1]: Starting smbd.service - Samba SMB Daemon...
Oct 16 19:31:49 <pi-hostname> smbd[33812]: [2025/10/16 19:31:49.408940,  0] ../../source3/smbd/server.c:1741(main)
Oct 16 19:31:49 <pi-hostname> smbd[33812]:   smbd version 4.17.12-Debian started.
Oct 16 19:31:49 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 19:49:12 <pi-hostname> smbd[33853]: [2025/10/16 19:49:12.048273,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 19:49:12 <pi-hostname> smbd[33853]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 19:49:12 <pi-hostname> smbd[33853]: [2025/10/16 19:49:12.049908,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 19:49:12 <pi-hostname> smbd[33853]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 17 02:08:53 <pi-hostname> smbd[34613]: [2025/10/17 02:08:53.801161,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 17 02:08:53 <pi-hostname> smbd[34613]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 17 02:08:53 <pi-hostname> smbd[34613]: [2025/10/17 02:08:53.801320,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 17 02:08:53 <pi-hostname> smbd[34613]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
```

### avahi-daemon (last 7 days)
```text
Oct 15 09:21:13 <pi-hostname> systemd[1]: Starting avahi-daemon.service - Avahi mDNS/DNS-SD Stack...
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Found user 'avahi' (UID 104) and group 'avahi' (GID 109).
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Successfully dropped root privileges.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: avahi-daemon 0.8 starting up.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Successfully called chroot().
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Successfully dropped remaining capabilities.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: No service file found in /etc/avahi/services.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface lo.IPv6 with address ::1.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: New relevant interface lo.IPv6 for mDNS.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface lo.IPv4 with address <LAN_IP>.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: New relevant interface lo.IPv4 for mDNS.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Network interface enumeration completed.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Registering new address record for ::1 on lo.*.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Registering new address record for <LAN_IP> on lo.IPv4.
Oct 15 09:21:14 <pi-hostname> systemd[1]: Started avahi-daemon.service - Avahi mDNS/DNS-SD Stack.
Oct 15 09:21:14 <pi-hostname> avahi-daemon[488]: Server startup complete. Host name is <pi-hostname>.local. Local service cookie is 2193710489.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface wlan0.IPv6 with address fe80::a848:c27c:1c93:5f60.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: New relevant interface wlan0.IPv6 for mDNS.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: Registering new address record for fe80::a848:c27c:1c93:5f60 on wlan0.*.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: New relevant interface wlan0.IPv4 for mDNS.
Oct 15 09:21:18 <pi-hostname> avahi-daemon[488]: Registering new address record for <LAN_IP> on wlan0.IPv4.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface eth0.IPv6 with address fe80::e748:ce4c:c8c7:c505.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: New relevant interface eth0.IPv6 for mDNS.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Registering new address record for fe80::e748:ce4c:c8c7:c505 on eth0.*.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: New relevant interface eth0.IPv4 for mDNS.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Registering new address record for <LAN_IP> on eth0.IPv4.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface wlan0.IPv6 with address fe80::a848:c27c:1c93:5f60.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Registering new address record for fd5b:d04e:624a:1:f388:68cb:715:457c on wlan0.*.
Oct 15 09:21:19 <pi-hostname> avahi-daemon[488]: Withdrawing address record for fe80::a848:c27c:1c93:5f60 on wlan0.
Oct 15 09:21:20 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface eth0.IPv6 with address fe80::e748:ce4c:c8c7:c505.
Oct 15 09:21:20 <pi-hostname> avahi-daemon[488]: Joining mDNS multicast group on interface eth0.IPv6 with address fd5b:d04e:624a:1:887b:2b48:d84a:903d.
Oct 15 09:21:20 <pi-hostname> avahi-daemon[488]: Registering new address record for fd5b:d04e:624a:1:887b:2b48:d84a:903d on eth0.*.
Oct 15 09:21:20 <pi-hostname> avahi-daemon[488]: Withdrawing address record for fe80::e748:ce4c:c8c7:c505 on eth0.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Got SIGTERM, quitting.
Oct 15 09:58:06 <pi-hostname> systemd[1]: Stopping avahi-daemon.service - Avahi mDNS/DNS-SD Stack...
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface eth0.IPv6 with address fd5b:d04e:624a:1:887b:2b48:d84a:903d.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface lo.IPv6 with address ::1.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: Leaving mDNS multicast group on interface lo.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[488]: avahi-daemon 0.8 exiting.
Oct 15 09:58:06 <pi-hostname> systemd[1]: avahi-daemon.service: Deactivated successfully.
Oct 15 09:58:06 <pi-hostname> systemd[1]: Stopped avahi-daemon.service - Avahi mDNS/DNS-SD Stack.
Oct 15 09:58:06 <pi-hostname> systemd[1]: avahi-daemon.service: Consumed 1.077s CPU time.
Oct 15 09:58:06 <pi-hostname> systemd[1]: Starting avahi-daemon.service - Avahi mDNS/DNS-SD Stack...
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Process 488 died: No such process; trying to remove PID file. (/run/avahi-daemon//pid)
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Found user 'avahi' (UID 104) and group 'avahi' (GID 109).
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Successfully dropped root privileges.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: avahi-daemon 0.8 starting up.
Oct 15 09:58:06 <pi-hostname> systemd[1]: Started avahi-daemon.service - Avahi mDNS/DNS-SD Stack.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Successfully called chroot().
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Successfully dropped remaining capabilities.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: No service file found in /etc/avahi/services.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: New relevant interface wlan0.IPv6 for mDNS.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: New relevant interface wlan0.IPv4 for mDNS.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface eth0.IPv6 with address fd5b:d04e:624a:1:887b:2b48:d84a:903d.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: New relevant interface eth0.IPv6 for mDNS.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: New relevant interface eth0.IPv4 for mDNS.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface lo.IPv6 with address ::1.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Joining mDNS multicast group on interface lo.IPv4 with address <LAN_IP>.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Network interface enumeration completed.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for fd5b:d04e:624a:1:f388:68cb:715:457c on wlan0.*.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for <LAN_IP> on wlan0.IPv4.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for fd5b:d04e:624a:1:887b:2b48:d84a:903d on eth0.*.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for <LAN_IP> on eth0.IPv4.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for ::1 on lo.*.
Oct 15 09:58:06 <pi-hostname> avahi-daemon[2387]: Registering new address record for <LAN_IP> on lo.IPv4.
Oct 15 09:58:07 <pi-hostname> avahi-daemon[2387]: Server startup complete. Host name is <pi-hostname>.local. Local service cookie is 3073884954.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Got SIGTERM, quitting.
Oct 15 10:35:25 <pi-hostname> systemd[1]: Stopping avahi-daemon.service - Avahi mDNS/DNS-SD Stack...
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface eth0.IPv6 with address fd5b:d04e:624a:1:887b:2b48:d84a:903d.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface lo.IPv6 with address ::1.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: Leaving mDNS multicast group on interface lo.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[2387]: avahi-daemon 0.8 exiting.
Oct 15 10:35:25 <pi-hostname> systemd[1]: avahi-daemon.service: Deactivated successfully.
Oct 15 10:35:25 <pi-hostname> systemd[1]: Stopped avahi-daemon.service - Avahi mDNS/DNS-SD Stack.
Oct 15 10:35:25 <pi-hostname> systemd[1]: avahi-daemon.service: Consumed 1.486s CPU time.
Oct 15 10:35:25 <pi-hostname> systemd[1]: Starting avahi-daemon.service - Avahi mDNS/DNS-SD Stack...
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Process 2387 died: No such process; trying to remove PID file. (/run/avahi-daemon//pid)
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Found user 'avahi' (UID 104) and group 'avahi' (GID 109).
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Successfully dropped root privileges.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: avahi-daemon 0.8 starting up.
Oct 15 10:35:25 <pi-hostname> systemd[1]: Started avahi-daemon.service - Avahi mDNS/DNS-SD Stack.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Successfully called chroot().
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Successfully dropped remaining capabilities.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: No service file found in /etc/avahi/services.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: New relevant interface wlan0.IPv6 for mDNS.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: New relevant interface wlan0.IPv4 for mDNS.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface eth0.IPv6 with address fd5b:d04e:624a:1:887b:2b48:d84a:903d.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: New relevant interface eth0.IPv6 for mDNS.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: New relevant interface eth0.IPv4 for mDNS.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface lo.IPv6 with address ::1.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface lo.IPv4 with address <LAN_IP>.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Network interface enumeration completed.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for fd5b:d04e:624a:1:f388:68cb:715:457c on wlan0.*.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for <LAN_IP> on wlan0.IPv4.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for fd5b:d04e:624a:1:887b:2b48:d84a:903d on eth0.*.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for <LAN_IP> on eth0.IPv4.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for ::1 on lo.*.
Oct 15 10:35:25 <pi-hostname> avahi-daemon[3940]: Registering new address record for <LAN_IP> on lo.IPv4.
Oct 15 10:35:26 <pi-hostname> avahi-daemon[3940]: Server startup complete. Host name is <pi-hostname>.local. Local service cookie is 1201069127.
Oct 16 00:28:42 <pi-hostname> avahi-daemon[3940]: Withdrawing address record for <LAN_IP> on eth0.
Oct 16 00:28:42 <pi-hostname> avahi-daemon[3940]: Leaving mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
```


## 10) Appendix — System Snapshots

### systemd service status (captured)
```text
systemd 252 (252.39-1~deb12u1)
+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified

● smbd.service - Samba SMB Daemon
     Loaded: loaded (/lib/systemd/system/smbd.service; enabled; preset: enabled)
     Active: active (running) since Thu 2025-10-16 19:31:49 PDT; 13h ago
       Docs: man:smbd(8)
             man:samba(7)
             man:smb.conf(5)
    Process: 33808 ExecCondition=/usr/share/samba/is-configured smb (code=exited, status=0/SUCCESS)
    Process: 33811 ExecStartPre=/usr/share/samba/update-apparmor-samba-profile (code=exited, status=0/SUCCESS)
   Main PID: 33812 (smbd)
     Status: "smbd: ready to serve connections..."
      Tasks: 9 (limit: 3915)
        CPU: 16min 6.796s
     CGroup: /system.slice/smbd.service
             ├─33812 /usr/sbin/smbd --foreground --no-process-group
             ├─33814 /usr/sbin/smbd --foreground --no-process-group
             ├─33815 /usr/sbin/smbd --foreground --no-process-group
             ├─34263 /usr/sbin/smbd --foreground --no-process-group
             └─35761 /usr/sbin/smbd --foreground --no-process-group

Oct 16 19:31:49 <pi-hostname> smbd[33812]:   Copyright Andrew Tridgell and the Samba Team 1992-2022
Oct 16 19:31:49 <pi-hostname> systemd[1]: Started smbd.service - Samba SMB Daemon.
Oct 16 19:49:12 <pi-hostname> smbd[33853]: [2025/10/16 19:49:12.048273,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 16 19:49:12 <pi-hostname> smbd[33853]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 16 19:49:12 <pi-hostname> smbd[33853]: [2025/10/16 19:49:12.049908,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 16 19:49:12 <pi-hostname> smbd[33853]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed
Oct 17 02:08:53 <pi-hostname> smbd[34613]: [2025/10/17 02:08:53.801161,  0] ../../source3/modules/vfs_fruit.c:5150(fruit_get_bandsize)
Oct 17 02:08:53 <pi-hostname> smbd[34613]:   fruit_get_bandsize: Didn't find band-size key in [/mnt/timemachine/<Mac-Computer-Name>.sparsebundle/Info.plist]
Oct 17 02:08:53 <pi-hostname> smbd[34613]: [2025/10/17 02:08:53.801320,  0] ../../source3/modules/vfs_fruit.c:5275(fruit_tmsize_do_dirent)
Oct 17 02:08:53 <pi-hostname> smbd[34613]:   fruit_tmsize_do_dirent: Processing sparsebundle [<Mac-Computer-Name>.sparsebundle] failed

○ nmbd.service - Samba NMB Daemon
     Loaded: loaded (/lib/systemd/system/nmbd.service; disabled; preset: enabled)
     Active: inactive (dead) (Result: exec-condition) since Thu 2025-10-16 19:24:02 PDT; 14h ago
   Duration: 1d 6h 2min 49.542s
  Condition: start condition failed at Thu 2025-10-16 19:24:02 PDT; 14h ago
       Docs: man:nmbd(8)
             man:samba(7)
             man:smb.conf(5)
    Process: 33252 ExecCondition=/usr/share/samba/is-configured nmb (code=exited, status=1/FAILURE)
        CPU: 332ms

Oct 16 19:24:02 <pi-hostname> systemd[1]: Starting nmbd.service - Samba NMB Daemon...
Oct 16 19:24:02 <pi-hostname> systemd[1]: nmbd.service: Skipped due to 'exec-condition'.
Oct 16 19:24:02 <pi-hostname> systemd[1]: Condition check resulted in nmbd.service - Samba NMB Daemon being skipped.


● avahi-daemon.service - Avahi mDNS/DNS-SD Stack
     Loaded: loaded (/lib/systemd/system/avahi-daemon.service; enabled; preset: enabled)
     Active: active (running) since Wed 2025-10-15 10:35:25 PDT; 1 day 22h ago
TriggeredBy: ● avahi-daemon.socket
   Main PID: 3940 (avahi-daemon)
     Status: "avahi-daemon 0.8 starting up."
      Tasks: 2 (limit: 3915)
        CPU: 1min 6.307s
     CGroup: /system.slice/avahi-daemon.service
             ├─3940 "avahi-daemon: running [<pi-hostname>.local]"
             └─3941 "avahi-daemon: chroot helper"

Oct 16 00:30:02 <pi-hostname> avahi-daemon[3940]: Withdrawing address record for fe80::e748:ce4c:c8c7:c505 on eth0.
Oct 16 00:30:05 <pi-hostname> avahi-daemon[3940]: Joining mDNS multicast group on interface eth0.IPv4 with address <LAN_IP>.
Oct 16 00:30:05 <pi-hostname> avahi-daemon[3940]: New relevant interface eth0.IPv4 for mDNS.
Oct 16 00:30:05 <pi-hostname> avahi-daemon[3940]: Registering new address record for <LAN_IP> on eth0.IPv4.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Interface wlan0.IPv6 no longer relevant for mDNS.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Leaving mDNS multicast group on interface wlan0.IPv6 with address fd5b:d04e:624a:1:f388:68cb:715:457c.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Interface wlan0.IPv4 no longer relevant for mDNS.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Leaving mDNS multicast group on interface wlan0.IPv4 with address <LAN_IP>.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Withdrawing address record for fd5b:d04e:624a:1:f388:68cb:715:457c on wlan0.
Oct 16 16:08:52 <pi-hostname> avahi-daemon[3940]: Withdrawing address record for <LAN_IP> on wlan0.
```

### Storage
```text
# lsblk
NAME          SIZE FSTYPE MOUNTPOINT       UUID
sda         931.5G                         
└─sda1      931.5G ext4   /mnt/timemachine 21f34b8f-69e9-4086-b605-15c0e90cfe47
mmcblk0      29.8G                         
├─mmcblk0p1   512M vfat   /boot/firmware   F737-8E10
└─mmcblk0p2  29.3G ext4   /                d6ecfcd5-2703-41bf-9301-10c403b6fb0c

# df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  1.6G     0  1.6G   0% /dev
tmpfs          tmpfs     380M   19M  361M   5% /run
/dev/mmcblk0p2 ext4       29G  2.6G   25G  10% /
tmpfs          tmpfs     1.9G     0  1.9G   0% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
/dev/mmcblk0p1 vfat      510M   77M  434M  16% /boot/firmware
log2ram        tmpfs     128M  1.2M  127M   1% /var/log
tmpfs          tmpfs     380M  4.0K  380M   1% /run/user/1000
/dev/sda1      ext4      916G  430G  440G  50% /mnt/timemachine
```